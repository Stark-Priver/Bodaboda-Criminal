{% extends "layout.html" %}

{% block title %}Edit Criminal - {{ criminal.name }}{% endblock %}

{% block content %}
<h2>Edit Criminal: {{ criminal.name }}</h2>
<hr>

{# Form for updating Name and Description #}
<form method="POST" action="{{ url_for('edit_criminal', criminal_id=criminal.id) }}">
    <input type="hidden" name="action" value="update_details">
    <div class="mb-3">
        <label for="name" class="form-label">Name <span class="text-danger">*</span></label>
        <input type="text" class="form-control" id="name" name="name" value="{{ criminal.name }}" required>
    </div>
    <div class="mb-3">
        <label for="description" class="form-label">Description</label>
        <textarea class="form-control" id="description" name="description" rows="3">{{ criminal.description }}</textarea>
    </div>
    <button type="submit" class="btn btn-primary">Update Details</button>
</form>
<hr>

{# Section for Managing Existing Images #}
<h4>Manage Existing Images</h4>
{% if images %}
<div class="row">
    {% for img in images %}
    <div class="col-md-3 col-sm-4 mb-3">
        <div class="card">
            <img src="{{ url_for('static', filename=img.image_path) }}" class="card-img-top" alt="Criminal Image {{ img.id }}" style="height: 150px; object-fit: cover;">
            <div class="card-body text-center">
                <form method="POST" action="{{ url_for('edit_criminal', criminal_id=criminal.id) }}" onsubmit="return confirm('Are you sure you want to delete this image?');">
                    <input type="hidden" name="action" value="delete_image">
                    <input type="hidden" name="image_id" value="{{ img.id }}">
                    <button type="submit" class="btn btn-sm btn-danger">Delete Image</button>
                </form>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<p>No images currently associated with this criminal.</p>
{% endif %}
<hr>

{# Form for Uploading New Images #}
<h4>Upload New Images</h4>
<form method="POST" action="{{ url_for('edit_criminal', criminal_id=criminal.id) }}" enctype="multipart/form-data">
    <input type="hidden" name="action" value="add_images">
    <div class="mb-3">
        <label for="new_photos_input" class="form-label">Select new image(s) to add</label>
        <input type="file" class="form-control" id="new_photos_input" name="new_photos_input" accept="image/png, image/jpeg, image/gif" multiple onchange="updateNewFilesInfo(event)">
        <div class="mt-2" id="newFilesPreviewInfo">
            <!-- JS will update this area -->
        </div>
    </div>
    <button type="submit" class="btn btn-success">Add Selected Images</button>
</form>
<hr>

<a href="{{ url_for('list_criminals') }}" class="btn btn-secondary mt-3">Back to Criminals List</a>
{% endblock %}

{% block scripts %}
<script>
function updateNewFilesInfo(event) {
    const fileInput = event.target;
    const previewInfo = document.getElementById('newFilesPreviewInfo');
    if (fileInput.files.length > 0) {
        if (fileInput.files.length === 1) {
            previewInfo.textContent = `Selected file: ${fileInput.files[0].name}`;
        } else {
            previewInfo.textContent = `${fileInput.files.length} files selected.`;
        }
    } else {
        previewInfo.textContent = '';
    }
}
</script>
{% endblock %}
